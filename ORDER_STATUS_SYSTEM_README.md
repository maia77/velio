# نظام إدارة حالة الطلبات - Velio Store

## نظرة عامة
تم تطوير نظام شامل لإدارة حالة الطلبات يتيح للعملاء تتبع طلباتهم ويمكن للمدير من إدارة الطلبات والموافقة عليها أو رفضها.

## الميزات الجديدة

### 1. نظام قاعدة البيانات للطلبات
- **جدول الطلبات (orders)**: يحتوي على جميع تفاصيل الطلب
- **جدول تاريخ الحالة (order_status_history)**: يتتبع جميع تغييرات حالة الطلب
- **حالات الطلب المتاحة**:
  - `pending` - قيد المراجعة
  - `processing` - قيد المعالجة  
  - `approved` - تم الموافقة
  - `rejected` - تم الرفض
  - `completed` - مكتمل
  - `cancelled` - ملغي

### 2. واجهة العميل
- **صفحة استعلام حالة الطلب** (`/order-status`)
  - البحث برقم الهاتف أو البريد الإلكتروني
  - عرض تفاصيل الطلب وحالته
  - عرض تاريخ تغيير الحالة
  - تصميم متجاوب وجذاب

### 3. واجهة المدير
- **صفحة إدارة الطلبات** (`/admin/orders`)
  - عرض جميع الطلبات مع إمكانية الفلترة
  - تحديث حالة الطلبات
  - إضافة ملاحظات المدير
  - إضافة سبب الرفض عند رفض الطلب
  - نظام ترقيم الصفحات

### 4. نظام الإشعارات
- **إشعارات تلقائية للعملاء** عند تغيير حالة الطلب
- **إشعارات للمدير** عند إنشاء طلب جديد
- **رسائل بريد إلكتروني مفصلة** مع تفاصيل الطلب

## كيفية الاستخدام

### للعملاء:
1. بعد إنشاء الطلب، احفظ رقم الطلب
2. اذهب إلى صفحة "حالة الطلب" من القائمة الرئيسية
3. ابحث برقم هاتفك أو بريدك الإلكتروني
4. ستظهر جميع طلباتك مع حالتها الحالية

### للمدير:
1. اذهب إلى صفحة "إدارة الطلبات" من القائمة الرئيسية
2. استخدم الفلاتر للبحث عن طلبات معينة
3. اضغط على "تحديث" لتغيير حالة الطلب
4. أضف ملاحظات أو سبب الرفض حسب الحاجة

## الملفات المضافة/المحدثة

### ملفات جديدة:
- `web/templates/order_status.html` - صفحة استعلام حالة الطلب
- `web/templates/admin_orders.html` - صفحة إدارة الطلبات
- `ORDER_STATUS_SYSTEM_README.md` - هذا الملف

### ملفات محدثة:
- `web/models.py` - إضافة نماذج Order و OrderStatusHistory
- `web/app.py` - إضافة API endpoints و routes جديدة
- `web/templates/index.html` - إضافة روابط للصفحات الجديدة

## API Endpoints الجديدة

### للعملاء:
- `GET /order-status` - صفحة استعلام حالة الطلب
- `GET /api/orders/<order_number>` - الحصول على تفاصيل طلب معين
- `POST /api/orders/search` - البحث عن الطلبات

### للمدير:
- `GET /admin/orders` - صفحة إدارة الطلبات
- `GET /api/admin/orders` - الحصول على جميع الطلبات
- `PUT /api/admin/orders/<order_id>/status` - تحديث حالة الطلب

## التحديثات المطلوبة

### 1. تحديث قاعدة البيانات:
```bash
# تشغيل التطبيق لإنشاء الجداول الجديدة
python web/app.py
```

### 2. اختبار النظام:
1. إنشاء طلب جديد
2. البحث عن الطلب في صفحة حالة الطلب
3. تحديث حالة الطلب من صفحة الإدارة
4. التحقق من وصول الإشعارات

## ملاحظات مهمة

- جميع الطلبات الجديدة تبدأ بحالة "قيد المراجعة"
- يمكن للمدير تغيير الحالة في أي وقت
- يتم إرسال إشعار للعميل عند تغيير الحالة (إذا كان لديه بريد إلكتروني)
- النظام متوافق مع التصميم الحالي للموقع
- جميع الصفحات متجاوبة مع الأجهزة المحمولة

## استكشاف الأخطاء

### إذا لم تظهر الطلبات:
- تأكد من أن قاعدة البيانات تم تحديثها
- تحقق من صحة رقم الهاتف أو البريد الإلكتروني

### إذا لم تصل الإشعارات:
- تحقق من إعدادات البريد الإلكتروني
- تأكد من صحة عنوان البريد الإلكتروني للعميل

### إذا لم تعمل صفحة الإدارة:
- تأكد من أن المستخدم لديه صلاحيات المدير
- تحقق من صحة API endpoints

## الدعم

لأي مشاكل أو استفسارات، يرجى مراجعة ملفات السجل أو التواصل مع فريق التطوير.

